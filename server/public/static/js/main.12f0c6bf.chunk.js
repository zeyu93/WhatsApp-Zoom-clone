(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{136:function(e,t){},138:function(e,t){},147:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n(0),r=n.n(a),s=n(25),i=n.n(s),o=n(7),l=n(150),u=n(158),j=n(161),d=n(151),b=n(156),O=n(157);function f(e){var t=e.setId,n=e.setName,r=Object(a.useRef)(),s=function(){var e=Object(O.a)();t(e)};return Object(c.jsxs)(l.a,{className:"d-flex flex-column justify-content-center",style:{height:"100vh"},children:[Object(c.jsx)(u.a,{children:Object(c.jsxs)(j.a,{children:[Object(c.jsx)(j.a.Header,{className:"text-center",children:Object(c.jsx)(u.a.Toggle,{as:d.a,variant:"link",eventKey:"0",children:"READ ME!"})}),Object(c.jsx)(u.a.Collapse,{eventKey:"0",children:Object(c.jsx)(j.a.Body,{children:"Hello! This is a WhatsApp clone built by Zeyu Liu using SocketIO and React Hooks. Enter your name and press start or create a random ID. Add a contact by their ID and can start a conversation with one or multiple contacts."})})]})}),Object(c.jsxs)(b.a,{onSubmit:function(e){e.preventDefault(),n(r.current.value),s()},className:"w-100",children:[Object(c.jsxs)(b.a.Group,{children:[Object(c.jsx)(b.a.Label,{children:"Enter Your Name"}),Object(c.jsx)(b.a.Control,{type:"text",ref:r,required:!0})]}),Object(c.jsx)(d.a,{type:"submit",className:"mr-2",children:"Start"}),Object(c.jsx)(d.a,{variant:"secondary",onClick:s,children:"Create Random ID"})]})]})}function x(e,t){var n="whatsapp-clone-"+e,c=Object(a.useState)((function(){var e=localStorage.getItem(n);return null!=e?JSON.parse(e):"function"===typeof t?t():t})),r=Object(o.a)(c,2),s=r[0],i=r[1];return Object(a.useEffect)((function(){localStorage.setItem(n,JSON.stringify(s))}),[n,s]),[s,i]}var m=n(30),v=n(20),h=r.a.createContext(),C=function(){return Object(a.useContext)(h)},p=function(e){var t=e.children,n=x("contacts",[]),a=Object(o.a)(n,2),r=a[0],s=a[1];return Object(c.jsx)(h.Provider,{value:{contacts:r,createContact:function(e,t){s((function(n){return[].concat(Object(v.a)(n),[{id:e,name:t}])}))}},children:t})},g=n(93),S=n.n(g),y=r.a.createContext(),N=function(){return Object(a.useContext)(y)},E=function(e){var t=e.id,n=e.children,r=Object(a.useState)(),s=Object(o.a)(r,2),i=s[0],l=s[1];return console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_DEV_URL),Object(a.useEffect)((function(){var e=S()(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_DEV_URL,{query:{id:t}});return l(e),function(){return e.close()}}),[t]),Object(c.jsx)(y.Provider,{value:i,children:n})},I=r.a.createContext(),T=function(){return Object(a.useContext)(I)},_=function(e){var t=e.children,n=e.id,r=C().contacts,s=x("coversations",[]),i=Object(o.a)(s,2),l=i[0],u=i[1],j=Object(a.useState)(0),d=Object(o.a)(j,2),b=d[0],O=d[1],f=N(),h=l.map((function(e,t){var c=e.ids.map((function(e){var t=r.find((function(t){return t.id===e})),n=t&&t.name||e;return{id:e,name:n}})),a=e.messages.map((function(e){var t=r.find((function(t){return t.id===e.sender})),c=t&&t.name||e.sender,a=e.sender===n;return Object(m.a)(Object(m.a)({},e),{},{senderName:c,fromMe:a})})),s=t===b;return Object(m.a)(Object(m.a)({},e),{},{messages:a,chatMembers:c,selected:s})})),p=Object(a.useCallback)((function(e){var t=e.ids,n=e.text,c={sender:e.sender,text:n};u((function(e){var n=!1,a=e.map((function(e){return k(e.ids,t)?(n=!0,Object(m.a)(Object(m.a)({},e),{},{messages:[].concat(Object(v.a)(e.messages),[c])})):e}));return n?a:[].concat(Object(v.a)(e),[{ids:t,messages:[c]}])}))}),[u]);Object(a.useEffect)((function(){if(f)return f.on("receive-message",p),function(){return f.off("receive-message")}}),[f,p]);return Object(c.jsx)(I.Provider,{value:{conversations:h,createConversation:function(e){u((function(t){var n=null;return t.some((function(t,c){return!!k(t.ids,e)&&(n=c,!0)}))?(O(n),Object(v.a)(t)):[].concat(Object(v.a)(t),[{ids:e,messages:[]}])}))},selectConversationIndex:O,selectedConversation:h[b],sendMessage:function(e){var t=h[b].chatMembers.map((function(e){return e.id}));f.emit("send-message",{ids:t,text:e,sender:n}),p({ids:t,text:e,sender:n})}},children:t})},k=function(e,t){return e.length===t.length&&(t.sort(),e.sort(),e.every((function(e,n){return e===t[n]})))},D=n(154);var M=function(e){var t=e.message,n=e.isLastMessage,r=Object(a.useCallback)((function(e){e&&e.scrollIntoView({smooth:!0})}),[]);return Object(c.jsxs)("div",{className:"my-1 d-flex flex-column ".concat(t.fromMe?"align-self-end":""),ref:n?r:null,children:[Object(c.jsx)("div",{className:"rounded px-2 py-1 ".concat(t.fromMe?"bg-primary text-white":"border"),children:t.text}),Object(c.jsx)("div",{className:"text-muted small ".concat(t.fromMe?"text-right":""),children:t.fromMe?"You":t.sender})]})};var R=function(e){var t=e.selectedConversation;return Object(c.jsx)(c.Fragment,{children:Object(c.jsx)("div",{className:"d-flex flex-column align-items-start justify-content-end px-3",children:t.messages.map((function(e,n){var a=t.messages.length-1===n;return Object(c.jsx)(M,{isLastMessage:a,message:e},n)}))})})},w=n(152),A=n(153),P=n(68),L=n.n(P),V=r.a.createContext(),K=function(e){var t=e.id,n=e.children,r=Object(a.useRef)(),s=Object(a.useRef)(),i=Object(a.useState)(null),l=Object(o.a)(i,2),u=l[0],j=l[1],d=Object(a.useState)(!1),b=Object(o.a)(d,2),O=b[0],f=b[1],x=Object(a.useState)(!1),m=Object(o.a)(x,2),v=m[0],h=m[1],C=Object(a.useState)(),p=Object(o.a)(C,2),g=p[0],S=p[1],y=Object(a.useState)(""),E=Object(o.a)(y,2),I=E[0],T=E[1],_=N();Object(a.useEffect)((function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){j(e),r.current&&(r.current.srcObject=e)})),_.on("hey",(function(e){h(!0),T(e.from),S(e.signal)}));var e=r.current;return console.log("copy",e),function(){console.log("running clean up"),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(t){var n=t.getTracks();n.forEach((function(e){e.stop()})),console.log(n),e&&(e.srcObject=null,j(null))}))}}),[_]);return Object(c.jsxs)(V.Provider,{value:{stream:u,userVideo:r,partnerVideo:s,callOtherUsersInChat:function(e){console.log("yoooooooo",e);var n=new L.a({initiator:!0,trickle:!1,stream:u});n.on("signal",(function(n){_.emit("callUser",{usersToCall:e,signalData:n,from:t})})),n.on("stream",(function(e){s.current&&(console.log(s.current),s.current.srcObject=e)})),_.on("callAccepted",(function(e){f(!0),n.signal(e)}))},receivingCall:v,caller:I,callAccepted:O,acceptCall:function(){f(!0);var e=new L.a({initiator:!1,trickle:!1,stream:u});e.on("signal",(function(e){_.emit("acceptCall",{signal:e,to:I})})),e.on("stream",(function(e){s.current.srcObject=e})),e.signal(g)},endCall:function(){console.log("ending Call"),f(!1),h(!1),S(null),r.current.srcObject.getTracks().forEach((function(e){e.stop()})),s.current.srcObject=null,r.current.srcObject=null}},children:[" ",n]})};var H=function(e){var t=e.selectedConversation,n=e.setVideoStart,a=e.videoStart;return Object(c.jsx)("div",{children:Object(c.jsxs)(w.a,{className:"px-3 m-2 d-flex align-items-center",variant:"primary",children:["Chat Member:"," ",t.chatMembers.map((function(e){return Object(c.jsx)(A.a,{children:e.name})})),Object(c.jsx)(d.a,{style:{marginLeft:"auto"},onClick:function(){n(!a)},variant:"primary",children:a?"End Video":"Enter Video Room"})]})})};var U=function(e){var t=e.selectedConversation,n=Object(a.useContext)(V),r=n.userVideo,s=n.callOtherUsersInChat,i=n.receivingCall,o=n.caller,l=n.acceptCall,u=n.callAccepted,j=n.partnerVideo,b=n.endCall;return Object(c.jsxs)("div",{className:"d-flex flex-column align-items-center m-5",children:[Object(c.jsxs)("div",{className:"d-flex flex-column ",children:[!u&&Object(c.jsx)(d.a,{className:"m-2 p-2",onClick:function(){return s(t.chatMembers)},children:"Call users in Chat"}),i&&!u&&Object(c.jsxs)(d.a,{className:"m-2 p-2",onClick:l,children:["Accept Call from ",o]}),u&&Object(c.jsx)(d.a,{className:"m-2 p-2",onClick:b,children:"End Call"})]}),Object(c.jsxs)("div",{className:"d-flex flex-column ",children:[Object(c.jsx)("video",{ref:r,playsInline:!0,muted:!0,autoPlay:!0,width:"500px",height:"500px"}),u&&Object(c.jsx)("video",{ref:j,playsInline:!0,muted:!0,autoPlay:!0,width:"500px",height:"500px"})]})]})};var B=function(e){var t=e.id,n=Object(a.useState)(""),r=Object(o.a)(n,2),s=r[0],i=r[1],l=T(),u=l.sendMessage,j=l.selectedConversation,O=Object(a.useState)(!1),f=Object(o.a)(O,2),x=f[0],m=f[1];return Object(c.jsxs)("div",{className:"d-flex flex-column flex-grow-1",children:[Object(c.jsx)(H,{selectedConversation:j,setVideoStart:m,videoStart:x}),x?Object(c.jsx)(K,{id:t,children:Object(c.jsx)(U,{selectedConversation:j})}):Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:"flex-grow-1 overflow-auto",children:Object(c.jsx)(R,{selectedConversation:j})}),Object(c.jsx)(b.a,{children:Object(c.jsx)(b.a.Group,{className:"m-2",children:Object(c.jsxs)(D.a,{children:[Object(c.jsx)(b.a.Control,{as:"textarea",required:!0,value:s,onChange:function(e){return i(e.target.value)},style:{height:"100px",resize:"none"}}),Object(c.jsx)(D.a.Append,{children:Object(c.jsx)(d.a,{onClick:function(e){e.preventDefault(),u(s),i("")},type:"submit",children:"Send"})})]})})})]})]})},F=n(159),W=n(160),q=n(155),G=n(162);var J=function(){var e=T(),t=e.conversations,n=e.selectConversationIndex;return Object(c.jsx)(G.a,{varaiant:"flush",children:t.map((function(e,t){return Object(c.jsx)(G.a.Item,{action:!0,active:e.selected,onClick:function(){return n(t)},children:(a=e.chatMembers,a.map((function(e){return e.name})).join(", "))},t);var a}))})};var Y=function(e){var t=e.closeModal,n=C().contacts,r=T().createConversation,s=Object(a.useState)([]),i=Object(o.a)(s,2),l=i[0],u=i[1];return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(q.a.Header,{closeButton:!0,children:"Create Conversation"}),Object(c.jsx)(q.a.Body,{children:Object(c.jsxs)(b.a,{onSubmit:function(e){e.preventDefault(),r(l),t()},children:[n.map((function(e){return Object(c.jsx)(b.a.Group,{controlId:e.id,children:Object(c.jsx)(b.a.Check,{type:"checkbox",value:l.includes(e.id),label:e.name,onChange:function(){var t;t=e.id,u((function(e){return e.includes(t)?e.filter((function(e){return e.id!==t})):[].concat(Object(v.a)(e),[t])}))}})},e.id)})),Object(c.jsx)(d.a,{type:"submit",children:"Create Conversation"})]})})]})};var z=function(e){var t=e.closeModal,n=Object(a.useRef)(),r=Object(a.useRef)(),s=C().createContact;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(q.a.Header,{closeButton:!0,children:"Create Contact"}),Object(c.jsx)(q.a.Body,{children:Object(c.jsxs)(b.a,{onSubmit:function(e){e.preventDefault(),s(n.current.value,r.current.value),t()},children:[Object(c.jsxs)(b.a.Group,{children:[Object(c.jsx)(b.a.Label,{children:"ID"}),Object(c.jsx)(b.a.Control,{type:"text",ref:n,required:!0})]}),Object(c.jsxs)(b.a.Group,{children:[Object(c.jsx)(b.a.Label,{children:"Name"}),Object(c.jsx)(b.a.Control,{type:"text",ref:r,required:!0})]}),Object(c.jsx)(d.a,{type:"submit",children:"Create Contact"})]})})]})},Z=function(){var e=C().contacts;return Object(c.jsx)(G.a,{varaiant:"flush",children:e.map((function(e){return Object(c.jsx)(G.a.Item,{children:e.name},e.id)}))})},Q="contacts",X="conversations";var $=function(e){var t=e.id,n=Object(a.useState)(X),r=Object(o.a)(n,2),s=r[0],i=r[1],l=Object(a.useState)(!1),u=Object(o.a)(l,2),j=u[0],b=u[1],O=s===X,f=function(){b(!1)};return Object(c.jsxs)("div",{style:{width:"250px"},className:"d-flex flex-column",children:[Object(c.jsxs)(F.a.Container,{activeKey:s,onSelect:i,children:[Object(c.jsxs)(W.a,{variant:"tabs",className:"justify-content-center",children:[Object(c.jsx)(W.a.Item,{children:Object(c.jsx)(W.a.Link,{eventKey:X,children:" Conversations"})}),Object(c.jsx)(W.a.Item,{children:Object(c.jsx)(W.a.Link,{eventKey:Q,children:"Contacts"})})]}),Object(c.jsxs)(F.a.Content,{className:"border-right overflow-auto flex-grow-1",children:[Object(c.jsx)(F.a.Pane,{eventKey:X,children:Object(c.jsx)(J,{})}),Object(c.jsx)(F.a.Pane,{eventKey:Q,children:Object(c.jsx)(Z,{})})]}),Object(c.jsxs)("div",{className:"p-2 border-top border-right small",children:["Your ID ",Object(c.jsxs)("span",{className:"text-muted",children:[" ",t]})]}),Object(c.jsxs)(d.a,{className:"rounded-0",onClick:function(){return b(!0)},children:["NEW ",O?"CONVERSATION":"CONTACTS"]})]}),Object(c.jsx)(q.a,{show:j,onHide:f,children:O?Object(c.jsx)(Y,{closeModal:f}):Object(c.jsx)(z,{closeModal:f})})]})};var ee=function(e){var t=e.id,n=T().selectedConversation;return Object(c.jsxs)("div",{className:"d-flex",style:{height:"100vh"},children:[Object(c.jsx)($,{id:t}),n&&Object(c.jsx)(B,{id:t})]})};var te=function(){var e=x("id",null),t=Object(o.a)(e,2),n=t[0],a=t[1],r=x("name",null),s=Object(o.a)(r,2),i=(s[0],s[1]);return n?Object(c.jsx)(E,{id:n,children:Object(c.jsx)(p,{children:Object(c.jsx)(_,{id:n,children:Object(c.jsx)(ee,{id:n})})})}):Object(c.jsx)(f,{setId:a,setName:i})};n(146);i.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(te,{})}),document.getElementById("root"))}},[[147,1,2]]]);
//# sourceMappingURL=main.12f0c6bf.chunk.js.map